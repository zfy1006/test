console.log(888)
console.log(999, document.getElementsByTagName('VIDEO'))

//下载失败的视频处理
let videoUrlRegexPattern = [
	{ pattern: /https:\/\/twitter.com\/(.*?)\/status\/[0-9\/]+/, videoType: 12 },
	{ pattern: /https:\/\/www.instagram.com\/p\/[a-zA-Z0-9\/_]+/, videoType: 10 },
	{ pattern: /https:\/\/www.facebook.com\/(.*?)\/videos\/[0-9\/]+/, videoType: 11 },
	{ pattern: /https:\/\/www.youtube.com\/embed\/[0-9a-zA-Z_\-?=&\/]+/, videoType: 2 },
	{ pattern: /https:\/\/www.youtube.com\/watch\?v=[0-9a-zA-Z_\-?=&\/]+/, videoType: 2 },
	{ pattern: /https:\/\/youtu.be\/[0-9a-zA-Z_\-?=&\/]+/, videoType: 2 }
]
let NodeList = [];
Array.from(document.getElementsByTagName('VIDEO')).forEach((node, idx) => {
	NodeList.push(node)
	//如果视频可以加载，则不跳转
	node.onloadedmetadata = () => {
		NodeList.splice(idx,1)
	};
});
NodeList.forEach(node => {
	let pNode = node.parentNode;
	let src = node.src;
	let srcType;
	let playUrlId;
	console.log(pNode);
	for (const item of videoUrlRegexPattern) {
		if (item.pattern.test(src)) {
			srcType = item.videoType
			break
		}
	}
	if(srcType == 2) { // youtube
		let urlArr;
		if(/https:\/\/www.youtube.com\/watch\?v=[0-9a-zA-Z_\-?=&\/]+/.test(src)) {
			urlArr = src.split('watch?v=');
		}else {
			urlArr = src.split('/');
		}
		playUrlId = urlArr[urlArr.length - 1];
		let newNode = document.createElement('p');
		newNode.innerHTML = `<iframe type="text/html" src="https://www.youtube.com/embed/${playUrlId}?autoplay=1&amp;controls=1" frameborder="0" allowfullscreen="1"></iframe>`
		pNode.replaceChild(newNode, node);
	}else if(srcType == 11){ // facebook
		playUrlId = encodeURIComponent(src);
		let newNode = document.createElement('p');
		newNode.innerHTML = `<iframe src="https://www.facebook.com/plugins/video.php?height=314&href=${playUrlId}&show_text=false&width=560&t=0" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share" allowFullScreen="true"></iframe>`
		pNode.replaceChild(newNode, node);
	}else if(srcType == 10) {//instagram
		playUrlId = src.match(/(?<=\/p\/)(\w+)/g)[0];
		let newNode = document.createElement('p');
		newNode.innerHTML = `<iframe src="https://www.instagram.com/p/${video.playUrlId}/embed" frameborder="0" scrolling="no" allowtransparency="true"></iframe>`
		pNode.replaceChild(newNode, node);
	}else {
		node.onclick = () => {
			window.open(src);
		}
	}
})